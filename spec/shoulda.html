<!DOCTYPE html>
<html>
<head>
	<title>Lawnchair Spec</title>
	<link rel="stylesheet" href="shoulda.css" type="text/css" media="screen" title="no title" charset="utf-8">
	
	<script src="qunit.js" type="text/javascript" charset="utf-8"></script>
	<script src="shoulda.js" type="text/javascript" charset="utf-8"></script>
	
	<script src="../src/adaptors/Helpers.js" type="text/javascript" charset="utf-8"></script>
	<script src="../src/adaptors/GearsSqliteAdaptor.js" type="text/javascript" charset="utf-8"></script>
	
	<script src="../src/adaptors/WebKitSqlteAdaptor.js" type="text/javascript" charset="utf-8"></script>
	<script src="../src/lawnchair.js" type="text/javascript" charset="utf-8"></script>
	
	<script type="text/javascript" charset="utf-8">
		
		/**
		 * A little setup code
		 *
		 *
		 *
		 */						
		
		context('Lawnchair', function(){


			var	store = new Lawnchair({table:'test', adaptor:'webkit'});
			var	me = {name:'brian', age:30};
			
			
			should( 'have no docs.', function(){			
				stop();
				store.nuke();
				store.all('equals(r.length, 0); start();');
			});
			
			
			should( 'save one doc.', function(){
				store.save(me);
				stop();
				store.all('equals(r.length, 1); start();')
			});
			
			
			should( 'save a second doc.', function(){
				store.save({name:'fred'});
				stop();
				store.all('equals(r.length, 2); start();')
			});
			
			
			should( 'return all docs as an array.', function(){
				stop();
				store.all('ok(typeof r == "array"); start();');
			});
			
			
			should( 'find doc with name:brian.', function(){
				stop();
				store.find('r.name == "brian"', 'equals(r.name, "brian"); start();');
			});
			
			
			should( 'remove one document.', function(){
				store.save({name:'joni'});
				stop();
				store.find("r.name == 'joni'", 'store.remove(r)');
				store.all('equals(r.length, 2); start();');
			});
			
			
			should( 'remove a doc by key.', function(){
				store.save({key:'die', name:'dudeman'});
				store.remove('die');
				stop();
				store.all('equals(r.length, 2); start();');
			});
			
			
			should( 'update my age to 31.', function() {
				stop();
				store.find( 
					'r.name == "brian"',
					function(r){
						// change my age
						r.age = 31;
						store.save(r);
						
						// test to see if it worked
						store.get(r.key, function(r) {
							equals(r.age, 31);
							start();
						});
				});
			});
			
			
			should( 'create a uuid.', function(){
				equals(store.adaptor.uuid().length, 36);
			});
			
		// ---	
		});
	</script>
</head>
<body>
	<h2 id="qunit-banner">Lawnchair Spec</h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
</body>
</html>
