var Lawnchair=function(A){this.init(A)};Lawnchair.prototype={init:function(A){var C=this;var D=C.merge;var B=(typeof arguments[0]=="string")?{table:A}:A;this.name=D("Lawnchair",B.name);this.version=D("1.0",B.version);this.table=D("field",B.table);this.display=D("shed",B.display);this.max=D(65536,B.max);this.db=D(null,B.db);this.onError=function(){};this.onData=function(){};if(!window.openDatabase){throw ('Lawnchair, "This browser does not support sqlite storage."')}this.db=openDatabase(this.name,this.version,this.display,this.max);this.db.transaction(function(E){E.executeSql("SELECT COUNT(*) FROM "+C.table,[],function(){},function(F,G){F.executeSql("CREATE TABLE "+C.table+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)",[],function(){},C.onError)})})},get:function(A,C){var B=this;this.db.transaction(function(D){D.executeSql("SELECT value FROM "+B.table+" WHERE id = ?",[A],function(E,F){if(F.rows.length==0){C(null)}else{var G=B.deserialize(F.rows.item(0).value);G.key=A;C(G)}},this.onError)})},remove:function(B){var A=this;this.db.transaction(function(C){C.executeSql("DELETE FROM "+A.table+" WHERE id = ?",[(typeof B=="string")?B:B.key],A.onData,A.onError)})},save:function(B,C){var A=this;if(B.key!=undefined){this.get(B.key,function(D){A.db.transaction(function(E){var F=B.key;delete (B.key);E.executeSql("UPDATE "+A.table+" SET value=?, timestamp=? WHERE id=?",[A.serialize(B),A.now(),F],function(G,H){if(C!=undefined){B.key=F;C(B)}},A.onError)})})}else{this.db.transaction(function(D){if(B.key==undefined){var E=A.uuid()}else{var E=B.key;delete (B.key)}D.executeSql("INSERT INTO "+A.table+" (id, value,timestamp) VALUES (?,?,?)",[E,A.serialize(B),A.now()],function(F,G){if(C!=undefined){B.key=E;C(B)}},A.onError)})}},nuke:function(){var A=this;this.db.transaction(function(B){B.executeSql("DELETE FROM "+A.table,[],A.onData,A.onError)});return this||A},find:function(condition,callback){var is=(typeof condition=="string")?function(r){return eval(condition)}:condition;var cb=this.terseToVerboseCallback(callback);this.each(function(record,index){if(is(record)){cb(record,index)}})},each:function(B){var A=this.terseToVerboseCallback(B);this.all(function(E){var C=E.length;for(var D=0;D<C;D++){A(E[D],D)}})},all:function(C){var A=this.terseToVerboseCallback(C);var B=this;this.db.transaction(function(D){D.executeSql("SELECT * FROM "+B.table,[],function(E,H){if(H.rows.length==0){A([])}else{var I=[];for(var G=0;G<H.rows.length;G++){var F=H.rows.item(G).value;var J=B.deserialize(F);J.key=H.rows.item(G).id;I.push(J)}A(I)}},B.onError)})},merge:function(A,B){return(B==undefined||B==null)?A:B},terseToVerboseCallback:function(callback){return(typeof arguments[0]=="string")?function(r){eval(callback)}:callback},now:function(){return new Date().getTime()},uuid:function(A,D){var F="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var C=[];D=D||F.length;if(A){for(var B=0;B<A;B++){C[B]=F[0|Math.random()*D]}}else{var E;C[8]=C[13]=C[18]=C[23]="-";C[14]="4";for(var B=0;B<36;B++){if(!C[B]){E=0|Math.random()*16;C[B]=F[(B==19)?(E&3)|8:E]}}}return C.join("")},serialize:function(F){var E="";if(typeof JSON!="undefined"){E=JSON.stringify(F)}else{E="{";var D=0;for(var B in F){D++}var A=0;for(var C in F){A++;E+='"'+C+'":';E+=typeof F[C]=="string"?'"'+F[C]+'"':F[C];E+=A<D?",":""}E+="}"}return E},deserialize:function(json){return eval("("+json+")")}};