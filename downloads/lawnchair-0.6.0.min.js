var Lawnchair=function(){if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(arguments.length<=2&&arguments.length>0)var a=typeof arguments[0]==="function"?arguments[0]:arguments[1],b=typeof arguments[0]==="function"?{}:arguments[0];else throw"Incorrect # of ctor args!";if(typeof a!=="function")throw"No callback was provided";this.record=b.record||"record";this.name=b.name||"records";var c;if(b.adapter){c=Lawnchair.adapters[Lawnchair.adapters.indexOf(b.adapter)];c=c.valid()?
c:undefined}else for(var d=0,e=Lawnchair.adapters.length;d<e;d++)if(c=Lawnchair.adapters[d].valid()?Lawnchair.adapters[d]:undefined)break;if(!c)throw"No valid adapter.";for(var f in c)this[f]=c[f];d=0;for(e=Lawnchair.plugins.length;d<e;d++)Lawnchair.plugins[d].call(this);this.init(b,a)};Lawnchair.adapters=[];
Lawnchair.adapter=function(a,b){b.adapter=a;var c="adapter valid init keys save batch get exists all remove nuke".split(" "),d;for(d in b)if(c.indexOf(d)===-1)throw"Invalid adapter! Nonstandard method: "+d;Lawnchair.adapters.push(b)};Lawnchair.plugins=[];Lawnchair.plugin=function(a){for(var b in a)b==="init"?Lawnchair.plugins.push(a[b]):this.prototype[b]=a[b]};
Lawnchair.prototype={isArray:Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"},lambda:function(a){return this.fn(this.record,a)},fn:function(a,b){return typeof b=="string"?new Function(a,b):b},uuid:function(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},each:function(a){var b=this.lambda(a);if(this.__results){a=0;for(var c=this.__results.length;a<c;a++)b.call(this,this.__results[a],
a)}else this.all(function(d){for(var e=0,f=d.length;e<f;e++)b.call(this,d[e],e)});return this}};
Lawnchair.adapter("dom",{valid:function(){return window.Storage!="undefined"},init:function(a,b){this.storage=window.localStorage;var c=this;this.indexer={key:c.name+"._index_",all:function(){JSON.parse(c.storage.getItem(this.key))==null&&c.storage.setItem(this.key,JSON.stringify([]));return JSON.parse(c.storage.getItem(this.key))},add:function(d){var e=this.all();e.push(d);c.storage.setItem(this.key,JSON.stringify(e))},del:function(d){for(var e=this.all(),f=[],g=0,h=e.length;g<h;g++)e[g]!=d&&f.push(e[g]);
c.storage.setItem(this.key,JSON.stringify(f))},find:function(d){for(var e=this.all(),f=0,g=e.length;f<g;f++)if(d===e[f])return f;return false}};b&&this.fn(this.name,b).call(this,this)},save:function(a,b){var c=a.key||this.uuid();this.indexer.find(c)||this.indexer.add(c);delete a.key;this.storage.setItem(c,JSON.stringify(a));if(b){a.key=c;this.lambda(b).call(this,a)}return this},batch:function(a,b){for(var c=[],d=0,e=a.length;d<e;d++)this.save(a[d],function(f){c.push(f)});b&&this.lambda(b).call(this,
c);return this},keys:function(){callback&&this.lambda(callback).call(this,this.indexer.all())},get:function(a,b){if(this.isArray(a)){for(var c=[],d=0,e=a.length;d<e;d++){var f=JSON.parse(this.storage.getItem(a[d]));if(f){f.key=a[d];c.push(f)}}b&&this.lambda(b).call(this,c)}else{if(f=JSON.parse(this.storage.getItem(a)))f.key=a;b&&this.lambda(b).call(this,f)}return this},all:function(a){for(var b=this.indexer.all(),c=[],d,e=0,f=b.length;e<f;e++){d=JSON.parse(this.storage.getItem(b[e]));d.key=b[e];c.push(d)}a&&
this.fn(this.name,a).call(this,c);return this},remove:function(a,b){var c=typeof a==="string"?a:a.key;this.indexer.del(c);this.storage.removeItem(c);b&&this.lambda(b).call(this);return this},nuke:function(a){this.all(function(b){for(var c=0,d=b.length;c<d;c++)this.remove(b[c]);a&&this.lambda(a).call(this)});return this}});
